<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.we.fullbuy.dao.GroudbuyMapper">
  <cache type="org.mybatis.caches.ehcache.EhcacheCache"/>
  <resultMap id="BaseResultMap" type="com.we.fullbuy.pojo.Groudbuy">
    <id column="gbId" jdbcType="INTEGER" property="gbid" />
    <result column="productId" jdbcType="INTEGER" property="productid" />
    <result column="minPeople" jdbcType="INTEGER" property="minpeople" />
    <result column="maxPeople" jdbcType="INTEGER" property="maxpeople" />
    <result column="nowPeople" jdbcType="INTEGER" property="nowpeople" />
    <result column="beginTime" jdbcType="TIMESTAMP" property="begintime" />
    <result column="endTime" jdbcType="TIMESTAMP" property="endtime" />
    <result column="gbStatus" jdbcType="INTEGER" property="gbstatus" />
    <result column="salesId" jdbcType="INTEGER" property="salesid" />
    <result column="bgColor" jdbcType="VARCHAR" property="bgcolor" />
  </resultMap>
  <sql id="Base_Column_List">
    gbId, productId, minPeople, maxPeople, nowPeople, beginTime, endTime, gbStatus, salesId, 
    bgColor
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from groudbuy
    where gbId = #{gbid,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from groudbuy
    where gbId = #{gbid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.we.fullbuy.pojo.Groudbuy">
    insert into groudbuy (gbId, productId, minPeople, 
      maxPeople, nowPeople, beginTime, 
      endTime, gbStatus, salesId, 
      bgColor)
    values (#{gbid,jdbcType=INTEGER}, #{productid,jdbcType=INTEGER}, #{minpeople,jdbcType=INTEGER}, 
      #{maxpeople,jdbcType=INTEGER}, #{nowpeople,jdbcType=INTEGER}, #{begintime,jdbcType=TIMESTAMP}, 
      #{endtime,jdbcType=TIMESTAMP}, #{gbstatus,jdbcType=INTEGER}, #{salesid,jdbcType=INTEGER}, 
      #{bgcolor,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.we.fullbuy.pojo.Groudbuy">
    insert into groudbuy
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="gbid != null">
        gbId,
      </if>
      <if test="productid != null">
        productId,
      </if>
      <if test="minpeople != null">
        minPeople,
      </if>
      <if test="maxpeople != null">
        maxPeople,
      </if>
      <if test="nowpeople != null">
        nowPeople,
      </if>
      <if test="begintime != null">
        beginTime,
      </if>
      <if test="endtime != null">
        endTime,
      </if>
      <if test="gbstatus != null">
        gbStatus,
      </if>
      <if test="salesid != null">
        salesId,
      </if>
      <if test="bgcolor != null">
        bgColor,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="gbid != null">
        #{gbid,jdbcType=INTEGER},
      </if>
      <if test="productid != null">
        #{productid,jdbcType=INTEGER},
      </if>
      <if test="minpeople != null">
        #{minpeople,jdbcType=INTEGER},
      </if>
      <if test="maxpeople != null">
        #{maxpeople,jdbcType=INTEGER},
      </if>
      <if test="nowpeople != null">
        #{nowpeople,jdbcType=INTEGER},
      </if>
      <if test="begintime != null">
        #{begintime,jdbcType=TIMESTAMP},
      </if>
      <if test="endtime != null">
        #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="gbstatus != null">
        #{gbstatus,jdbcType=INTEGER},
      </if>
      <if test="salesid != null">
        #{salesid,jdbcType=INTEGER},
      </if>
      <if test="bgcolor != null">
        #{bgcolor,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.we.fullbuy.pojo.Groudbuy">
    update groudbuy
    <set>
      <if test="productid != null">
        productId = #{productid,jdbcType=INTEGER},
      </if>
      <if test="minpeople != null">
        minPeople = #{minpeople,jdbcType=INTEGER},
      </if>
      <if test="maxpeople != null">
        maxPeople = #{maxpeople,jdbcType=INTEGER},
      </if>
      <if test="nowpeople != null">
        nowPeople = #{nowpeople,jdbcType=INTEGER},
      </if>
      <if test="begintime != null">
        beginTime = #{begintime,jdbcType=TIMESTAMP},
      </if>
      <if test="endtime != null">
        endTime = #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="gbstatus != null">
        gbStatus = #{gbstatus,jdbcType=INTEGER},
      </if>
      <if test="salesid != null">
        salesId = #{salesid,jdbcType=INTEGER},
      </if>
      <if test="bgcolor != null">
        bgColor = #{bgcolor,jdbcType=VARCHAR},
      </if>
    </set>
    where gbId = #{gbid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.we.fullbuy.pojo.Groudbuy">
    update groudbuy
    set productId = #{productid,jdbcType=INTEGER},
      minPeople = #{minpeople,jdbcType=INTEGER},
      maxPeople = #{maxpeople,jdbcType=INTEGER},
      nowPeople = #{nowpeople,jdbcType=INTEGER},
      beginTime = #{begintime,jdbcType=TIMESTAMP},
      endTime = #{endtime,jdbcType=TIMESTAMP},
      gbStatus = #{gbstatus,jdbcType=INTEGER},
      salesId = #{salesid,jdbcType=INTEGER},
      bgColor = #{bgcolor,jdbcType=VARCHAR}
    where gbId = #{gbid,jdbcType=INTEGER}
  </update>

  <!--new-->
  <select id="selectBySalesId" resultMap="BaseResultMap">
    select *
    from groudbuy
    where salesId = #{salesid,jdbcType=INTEGER}
  </select>

  <select id="searchGroudbuy" resultMap="BaseResultMap">
    select g.*,p.*
    from groudbuy g,product p
    where g.productId = p.productId and productName like `%` #{keyword} `%`
  </select>

  <select id="showAllGroudbuy" resultMap="BaseResultMap">
    select *
    from groudbuy
  </select>

  <resultMap id="GroudbuyWithProduct" type="com.we.fullbuy.pojo.Groudbuy" extends="BaseResultMap">
    <association property="product" javaType="com.we.fullbuy.pojo.Product">
      <id column="productId" jdbcType="INTEGER" property="productid" />
      <result column="productName" jdbcType="VARCHAR" property="productname" />
      <result column="productDetail" jdbcType="VARCHAR" property="productdetail" />
      <result column="productScore" jdbcType="INTEGER" property="productscore" />
      <result column="salesNum" jdbcType="INTEGER" property="salesnum" />
      <result column="categoryId" jdbcType="INTEGER" property="categoryid" />
      <result column="salesId" jdbcType="INTEGER" property="salesid" />
      <result column="postTime" jdbcType="TIMESTAMP" property="posttime" />
      <result column="productStatus" jdbcType="INTEGER" property="productstatus" />
      <result column="searchImgPath" jdbcType="VARCHAR" property="searchimgpath" />
      <result column="sImgPath1" jdbcType="VARCHAR" property="simgpath1" />
      <result column="sImgPath2" jdbcType="VARCHAR" property="simgpath2" />
      <result column="mImgPath1" jdbcType="VARCHAR" property="mimgpath1" />
      <result column="mImgPath2" jdbcType="VARCHAR" property="mimgpath2" />
      <result column="bImgPath1" jdbcType="VARCHAR" property="bimgpath1" />
      <result column="bImgPath2" jdbcType="VARCHAR" property="bimgpath2" />
      <result column="DetailImgPath1" jdbcType="VARCHAR" property="detailimgpath1" />
      <result column="DetailImgPath2" jdbcType="VARCHAR" property="detailimgpath2" />
      <result column="item1" jdbcType="VARCHAR" property="item1" />
      <result column="item2" jdbcType="VARCHAR" property="item2" />
      <result column="postfee" jdbcType="INTEGER" property="postfee" />
      <collection property="skuList" ofType="com.we.fullbuy.pojo.Sku">
        <id column="skuId" jdbcType="INTEGER" property="skuid" />
        <result column="productId" jdbcType="INTEGER" property="productid" />
        <result column="itemId" jdbcType="INTEGER" property="itemid" />
        <result column="secondItemId" jdbcType="INTEGER" property="seconditemid" />
        <result column="price" jdbcType="DOUBLE" property="price" />
        <result column="quantity" jdbcType="INTEGER" property="quantity" />
        <result column="gbPrice" jdbcType="DOUBLE" property="gbprice" />
        <collection property="itemList" ofType="com.we.fullbuy.pojo.Item">
          <id column="itemId" jdbcType="INTEGER" property="itemid" />
          <result column="itemName" jdbcType="VARCHAR" property="itemname" />
        </collection>
        <collection property="seconditemList" ofType="com.we.fullbuy.pojo.Seconditem">
          <id column="secondItemId" jdbcType="INTEGER" property="seconditemid" />
          <result column="secondItemName" jdbcType="VARCHAR" property="seconditemname" />
        </collection>
      </collection>
    </association>
  </resultMap>

  <select id="showGroudbuyDetail" resultMap="GroudbuyWithProduct">
    select g.*,p.*
    from groudbuy g,product p
    where g.productId = #{productid,jdbcType=INTEGER} and p.productId = g.productId and p.productStatus = 2 and g.gbStatus = 1
  </select>
</mapper>